// Generated by CoffeeScript 1.10.0
var myApp, saveData, settings;

saveData = function(key, value) {
  window.localStorage['key'] = JSON.stringify(value);
  return JSON.parse(window.localStorage[key] || '{}');
};

settings = JSON.parse(window.localStorage.settings || '{}');

settings = {};

myApp = angular.module('starter.controllers', ['ionic']);

myApp.controller('DashCtrl', function($scope, $ionicLoading) {
  var baseWeatherURL, convertKelvinToCelsius, convertKelvinToFahrenheit, processWeatherData;
  baseWeatherURL = 'http://api.openweathermap.org/data/2.5/weather';
  $scope.weatherData = JSON.parse(window.localStorage['weatherData'] || '[]');
  convertKelvinToFahrenheit = function(K) {
    return (K - 273.15) * 1.8000 + 32.00;
  };
  convertKelvinToCelsius = function(K) {
    return K - 273.15;
  };
  processWeatherData = function(data) {
    var temperature_mode, weatherData;
    temperature_mode = settings.fahrenheit || true;
    if (temperature_mode) {
      weatherData = {
        name: data.name,
        description: data.weather[0].description,
        temp: convertKelvinToFahrenheit(data.main.temp),
        temp_min: convertKelvinToFahrenheit(data.main.temp_min),
        temp_max: convertKelvinToFahrenheit(data.main.temp_max)
      };
    } else {
      weatherData = {
        name: data.name,
        description: data.weather[0].description,
        temp: convertKelvinToCelsius(data.main.temp),
        temp_min: convertKelvinToCelsius(data.main.temp_min),
        temp_max: convertKelvinToCelsius(data.main.temp_max)
      };
    }
    return weatherData;
  };
  $scope.weatherPoll = function(zip, region) {
    if (region == null) {
      region = 'us';
    }
    $ionicLoading.show({
      template: 'Loading...'
    });
    return $.ajax({
      url: baseWeatherURL,
      type: 'get',
      data: {
        zip: zip,
        region: region,
        APPID: 'dd9f3e622ff8e3dde48856f172b598d8'
      },
      error: function(error) {
        $ionicLoading.hide();
        return console.log(error);
      },
      success: function(data) {
        $ionicLoading.hide();
        $scope.weatherData.push(processWeatherData(data));
        return saveData('weatherData', $scope.weatherData);
      }
    });
  };
  return $scope.weatherPoll('22314', 'us');
});

myApp.controller('ChatsCtrl', function($scope, Chats) {
  $scope.chats = Chats.all();
  return $scope.remove = function(chat) {
    return Chats.remove(chat);
  };
});

myApp.controller('ChatDetailCtrl', function($scope, $stateParams, Chats) {
  return $scope.chat = Chats.get($stateParams.chatId);
});

myApp.controller('AccountCtrl', function($scope) {
  $scope.watchCollection('settings', function() {
    saveData('settings', $scope.settings);
    settings = $scope.settings;
    return console.log(settings);
  });
  $scope.settings = JSON.parse(window.localStorage['settings'] || '{}');
  if ($scope.settings == null) {
    return $scope.settings = {
      enableFriends: true,
      fahrenheit: true
    };
  }
});
